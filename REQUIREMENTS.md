# RIZIN選手名山手線ゲーム Webアプリケーション要件定義書

## 概要
RIZIN選手名を使った山手線ゲームを支援するWebアプリケーション。
リアルタイムで選手名を記録し、重複や言い忘れを防ぐことで、ゲームの公平性を保つ。

## 主要機能

### 1. ユーザー管理機能
- **ユーザー登録**
  - ユーザー名
  - メールアドレス
  - パスワード
- **ログイン/ログアウト**
  - メールアドレスとパスワードによる認証
- **プロフィール管理**
  - ユーザー名の変更
  - アバター画像（オプション）

### 2. ゲームセッション機能
- **セッション作成**
  - セッション名の設定
  - 参加人数の上限設定（オプション）
  - セッションIDの自動生成
  - QRコード生成（参加しやすくするため）
- **セッション参加**
  - セッションIDまたはQRコードで参加
  - 参加者リストのリアルタイム表示
- **セッション管理**
  - ホスト権限（セッション作成者）
  - ゲーム開始/終了の制御
  - 参加者の強制退出（ホストのみ）

### 3. 選手名入力・記録機能
- **インクリメンタルサーチ**
  - **ひらがな入力のみ対応**（表記揺れ防止）
  - **重要：候補が1人に絞られた時点でのみサジェスト表示**
  - 入力は全てひらがなに統一
- **選手名記録**
  - 選択した選手名をセッションに記録
  - タイムスタンプ付き
  - 入力者の記録
- **重複チェック**
  - 既に言われた選手名は選択不可
  - 視覚的に区別（グレーアウトなど）

### 4. ゲーム進行管理
- **ターン管理**
  - **ターン制（山手線ゲーム本来のルール）**
  - 現在の手番プレイヤーの表示
  - 回答後に次のプレイヤーへ自動切り替え
  - **制限時間なし（じっくり考えてOK）**
  - **パス不可（ギブアップのみ）**
  - 手番以外のプレイヤーは入力不可
- **履歴表示**
  - 既出選手名のリスト表示
  - 入力者と時刻の表示
  - 検索・フィルター機能
- **統計情報**
  - 各プレイヤーの入力数
  - 残り選手数の目安表示
- **勝敗判定**
  - ギブアップしたプレイヤーは脱落
  - 最後まで残った人が勝利
  - 全選手言い切りの場合は残存者全員が勝利

### 5. リアルタイム同期
- **WebSocket通信**
  - Action Cableを使用
  - 選手名入力の即時反映
  - 参加者の入退室通知
- **画面自動更新**
  - 新規入力の即座表示
  - ターン切り替えの同期

## 技術要件

### フロントエンド
- Rails標準のERBテンプレート
- Turbo (Hotwire)
- Stimulus.js
- インクリメンタルサーチはTurbo Framesで実装

### バックエンド
- Ruby on Rails 8.0
- MySQL 8
- Action Cable（WebSocket）
- ActiveRecord

### データモデル（概要）
```
User
- name
- email
- password_digest

GameSession
- name
- code (unique)
- host_user_id
- status (waiting/playing/finished)
- winner_user_id (nullable)
- created_at

SessionParticipant
- game_session_id
- user_id
- joined_at
- turn_order

Fighter
- full_name（漢字表記） unique
- full_name_hiragana（ひらがな表記） unique
- ring_name（リングネーム） unique
- ring_name_hiragana（リングネームひらがな） unique
- is_active（現役フラグ）

WeightClass
- japanese_name unique
- english_name unique

FighterWeightClass
- fighter_id
- weight_class_id

SessionAnswer
- game_session_id
- user_id
- fighter_id
- answered_at
- turn_number
  game_session_idとfighter_idの組み合わせはunique
  game_session_idとturn_numberの組み合わせはunique
```

## UI/UX要件

### 画面構成
1. **ログイン/登録画面**
2. **ダッシュボード**
   - 参加可能なセッション一覧
   - 新規セッション作成ボタン
3. **ゲームプレイ画面**
   - 選手名入力フォーム（上部）
   - 既出選手リスト（中央）
   - 参加者リスト（サイドバー）

### レスポンシブデザイン
- スマートフォンでの操作を最優先
- タブレット・PC対応

## セキュリティ要件
- CSRF対策
- SQLインジェクション対策
- XSS対策
- パスワードのbcrypt暗号化

## パフォーマンス要件
- 選手名サジェスト：200ms以内のレスポンス
- 同時接続：最大5セッション
- 1セッションあたり最大4名

## 今後の拡張機能（Phase 2）
- [ ] トーナメントモード
- [ ] ランキング機能
- [ ] 選手情報詳細表示（戦績など）
- [ ] カスタムルール設定
- [ ] 音声入力対応
- [ ] 観戦モード

## 実装方針

### データ取得
- **選手データ**: RakeタスクでRIZIN公式サイトからスクレイピング
  - 定期的な更新をcronで自動化も可能
  - 選手名の正式表記を自動取得

## 開発フェーズ
### Phase 1（MVP）
- ユーザー登録・ログイン
- セッション作成・参加
- 選手名入力（サジェスト機能）
- リアルタイム同期
- 基本的な履歴表示

### Phase 2
- 統計機能
- UI/UXの改善
- パフォーマンス最適化

### Phase 3
- 拡張機能の実装