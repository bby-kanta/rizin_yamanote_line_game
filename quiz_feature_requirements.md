# 山手線ゲーム風クイズ機能 要件定義

## 機能概要
fighterの情報を使った推理クイズゲーム。参加者は段階的に出される特徴から選手を推理し、正解までの速さと正確性で競う。

## ゲームフロー

### 1. セッション作成・開始
- セッションを作成し、参加者を募る
- `fighter_features`テーブルにレコードが存在するfighterの中からランダムに1人を選出
- セッション開始

### 2. ゲーム進行
- 選出されたfighterの特徴を1つずつ段階的に公開
- 各特徴公開後、参加者は以下を選択：
  - **回答**: fighterを推測して回答
  - **パス**: 次の特徴を待つ
- 回答が間違った場合、ミス回数を記録（1回追加）

### 3. 勝敗判定
- 全員が正解した時点でゲーム終了
- 勝者決定要素：
  - **正解までの速さ（第何ヒントで正解したか）**
  - **ミス回数**
- ポイント計算：
  - ミス1回 = 3ヒント分遅く答えたユーザーと同等のペナルティ

## データベース設計

### fighter_features テーブル
```sql
fighter_features
├── id (Primary Key)
├── fighter_id (Foreign Key to fighters)
├── feature (string) - 特徴の内容
├── level (integer: 1,2,3) - 難易度レベル
├── fighter_feature_category_id (Foreign Key)
└── timestamps
```

### fighter_feature_categories テーブル
```sql
fighter_feature_categories
├── id (Primary Key)
├── name (string) - カテゴリ名
└── timestamps
```

#### 初期カテゴリ候補
- 階級
- 戦績  
- 来歴
- 通称
- 所属
- ファイトスタイル
- その他

## UI/UX 要件

### 特徴作成機能
**場所**: 選手詳細画面
- 特徴作成ページへの導線を設置
- 動的フォーム：無限にフォームを追加可能
- 各フォームの項目：
  - 特徴内容（テキスト）
  - レベル（1-3選択）
    - レベルは1が最も簡単、3が最も難しい
  - カテゴリ（選択式）

### AI生成機能
- 「AI生成」ボタンを配置
- 機能：
  - GeminiでWikipediaを検索でその選手の情報を取得し、最終的にJSON形式でアウトプットを出させるプロンプトを作成
  ```    
  {
    "features": [
      {
        "category": "階級",
        "level": 3,
        "feature": "フェザー級"
      },
      {
        "category": "戦績",
        "level": 1,
        "feature": "〇〇に5分3R終了 判定2-1で勝利"
      },
      {
          "category": "来歴",
          "level": 2,
          "feature": "2020年にプロデビュー"
      },
      {
          "category": "通称",
          "level": 1,
          "feature": "路上の伝説"
      },
      {
          "category": "所属",
          "level": 1,
          "feature": "JTTジム"
      },
      {
          "category": "ファイトスタイル",
          "level": 3,
          "feature": "空手"
      }
      ...
    ]`
  }
  ```
  - なるべく全カテゴリを埋めるように特徴を生成
    - ない場合は諦めて良い
    - 適切なカテゴリがないと判断されたときは必ず「その他」を選択
  - トータルで30個ぐらいの特徴をサジェストできれば良い
  - 特徴を1文1フォームで自動生成
    - 特徴はレベル1から3まで自動設定
    - レベル3は誰にでも当てはまる簡単な特徴（例: 「日本人である」）
    - レベル2は中程度の特徴（例: 「2020年にプロデビュー」）
    - レベル1はその人しか無いような詳細な特徴（例: 「〇〇というラーメン屋をオープンした」など）
  - レベルとカテゴリも自動設定
    - 階級はレベル3で設定する
      - 「〇〇級」みたいなフォーマット
    - 通称はレベル1で設定する
      - 「路上の伝説」みたいなフォーマット
    - ファイトスタイルはレベル3で設定する
      - 「空手」「ストライカー」「グラップラー」「レスラー」など
    - 戦績はレベル1で設定する
      - 直近5試合の勝敗を自動取得
      - 「〇〇に5分3R終了 判定2-1で勝利」みたいなフォーマット

## 技術仕様

### セッション管理
- WebSocketまたはリアルタイム通信でゲーム状態を同期
- 参加者の回答状況をリアルタイムで管理

### ポイント計算ロジック
```
基本ポイント = (最大ヒント数 - 使用ヒント数) * 基準ポイント
ペナルティ = ミス回数 * 3 * 基準ポイント  
最終ポイント = 基本ポイント - ペナルティ
```

### 特徴出題順序
- レベル3 → レベル2 → レベル1 の順で出題
- 同レベル内ではランダム順序
