<div class="container">
  <h1 class="mb-4">
    <i class="fas fa-history me-2"></i>過去のゲーム履歴
  </h1>

  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><%= link_to "ホーム", root_path %></li>
      <li class="breadcrumb-item"><%= link_to "ゲーム一覧", game_sessions_path %></li>
      <li class="breadcrumb-item active" aria-current="page">ゲーム履歴</li>
    </ol>
  </nav>

  <% if @finished_sessions.any? %>
    <div class="card">
      <div class="card-body">
        <div class="table-responsive">
          <table class="table table-hover">
            <thead>
              <tr>
                <th>ゲーム名</th>
                <th>勝者</th>
                <th>作成者</th>
                <th>参加者</th>
                <th>開始日時</th>
                <th>終了日時</th>
                <th>プレイ時間</th>
                <th></th>
              </tr>
            </thead>
            <tbody>
              <% @finished_sessions.each do |session| %>
                <tr>
                  <td>
                    <strong><%= session.name %></strong>
                  </td>
                  <td>
                    <% if session.winner_user %>
                      <span class="badge bg-success">
                        <i class="fas fa-trophy me-1"></i>
                        <%= session.winner_user.name %>
                      </span>
                    <% else %>
                      <span class="text-muted">-</span>
                    <% end %>
                  </td>
                  <td>
                    <small class="text-muted"><%= session.creator.name %></small>
                  </td>
                  <td>
                    <% session.game_players.limit(3).each do |player| %>
                      <span class="badge bg-secondary me-1">
                        <%= player.user.name %>
                        <% if player.is_eliminated %>
                          <i class="fas fa-skull-crossbones ms-1" title="脱落"></i>
                        <% end %>
                      </span>
                    <% end %>
                    <% if session.game_players.count > 3 %>
                      <small class="text-muted">他<%= session.game_players.count - 3 %>人</small>
                    <% end %>
                  </td>
                  <td>
                    <small><%= session.started_at&.strftime("%Y/%m/%d %H:%M") %></small>
                  </td>
                  <td>
                    <small><%= session.ended_at&.strftime("%Y/%m/%d %H:%M") %></small>
                  </td>
                  <td>
                    <% if session.started_at && session.ended_at %>
                      <% duration = (session.ended_at - session.started_at).to_i %>
                      <% hours = duration / 3600 %>
                      <% minutes = (duration % 3600) / 60 %>
                      <small>
                        <% if hours > 0 %>
                          <%= hours %>時間<%= minutes %>分
                        <% else %>
                          <%= minutes %>分
                        <% end %>
                      </small>
                    <% else %>
                      <small class="text-muted">-</small>
                    <% end %>
                  </td>
                  <td>
                    <%= link_to "詳細", session, class: "btn btn-sm btn-outline-primary" %>
                  </td>
                </tr>
              <% end %>
            </tbody>
          </table>
        </div>

      </div>
    </div>
  <% else %>
    <div class="alert alert-info">
      <i class="fas fa-info-circle me-2"></i>
      まだ終了したゲームがありません。
    </div>
  <% end %>

  <div class="mt-3">
    <%= link_to "← ゲーム一覧に戻る", game_sessions_path, class: "btn btn-secondary" %>
  </div>
</div>