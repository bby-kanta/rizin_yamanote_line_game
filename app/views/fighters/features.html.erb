<div class="d-flex justify-content-between align-items-start mb-4">
  <div>
    <h1><%= @fighter.display_name %>の特徴管理</h1>
    <p class="text-muted">クイズゲーム用の特徴を管理できます。</p>
  </div>
  <div>
    <%= link_to "選手詳細に戻る", @fighter, class: "btn btn-secondary" %>
  </div>
</div>

<!-- 既存の特徴一覧 -->
<% if @features.any? %>
<div class="card mb-4">
  <div class="card-header">
    <h5 class="mb-0">既存の特徴（<%= @features.count %>件）</h5>
  </div>
  <div class="card-body">
    <div class="table-responsive">
      <table class="table table-striped">
        <thead>
          <tr>
            <th>カテゴリ</th>
            <th>レベル</th>
            <th>特徴</th>
            <th>作成日</th>
          </tr>
        </thead>
        <tbody>
          <% @features.each do |feature| %>
          <tr>
            <td><%= feature.category_name %></td>
            <td>
              <span class="badge <%= feature.level == 1 ? 'bg-danger' : feature.level == 2 ? 'bg-warning' : 'bg-success' %>">
                レベル<%= feature.level %>（<%= feature.level_text %>）
              </span>
            </td>
            <td><%= feature.feature %></td>
            <td><%= feature.created_at.strftime('%Y-%m-%d %H:%M') %></td>
          </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  </div>
</div>
<% end %>

<!-- 特徴作成フォーム -->
<div class="card">
  <div class="card-header d-flex justify-content-between align-items-center">
    <h5 class="mb-0">新しい特徴を追加</h5>
    <button type="button" id="generate-ai-features" class="btn btn-primary" data-fighter-id="<%= @fighter.id %>">
      <i class="bi bi-robot"></i> AI生成
    </button>
  </div>
  <div class="card-body">
    <div id="ai-loading" style="display: none;" class="alert alert-info">
      <div class="d-flex align-items-center">
        <div class="spinner-border spinner-border-sm me-2" role="status">
          <span class="visually-hidden">Loading...</span>
        </div>
        AI特徴を生成中です。しばらくお待ちください...
      </div>
    </div>
    
    <%= form_with url: create_features_fighter_path(@fighter), method: :post, local: true, id: "features-form" do |form| %>
      <div id="features-container">
        <!-- 初期フォーム行 -->
        <div class="feature-row mb-3">
          <div class="row">
            <div class="col-md-3">
              <select name="features[0][category_id]" class="form-select" required>
                <option value="">カテゴリを選択</option>
                <% @categories.each do |category| %>
                  <option value="<%= category.id %>"><%= category.name %></option>
                <% end %>
              </select>
            </div>
            <div class="col-md-2">
              <select name="features[0][level]" class="form-select" required>
                <option value="">レベル</option>
                <option value="1">1（具体性が高い）</option>
                <option value="2">2（普通）</option>
                <option value="3">3（抽象度が高い）</option>
              </select>
            </div>
            <div class="col-md-6">
              <input type="text" name="features[0][feature]" class="form-control" placeholder="特徴を入力">
            </div>
            <div class="col-md-1">
              <button type="button" class="btn btn-danger remove-feature">削除</button>
            </div>
          </div>
        </div>
      </div>
      
      <div class="d-flex justify-content-between">
        <button type="button" id="add-feature" class="btn btn-secondary">
          <i class="bi bi-plus-circle"></i> 特徴を追加
        </button>
        
        <div>
          <button type="button" id="clear-all" class="btn btn-warning me-2">全クリア</button>
          <button type="submit" class="btn btn-success">特徴を保存</button>
        </div>
      </div>
    <% end %>
  </div>
</div>

